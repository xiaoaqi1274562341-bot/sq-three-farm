import{h as r,C as d,V as s,L as V,a as u,O as p,b as A,S as g,c as w,d as f,e as y,W as M,P as v,A as b,f as l,g as C,i as S,D as L,j as E,T as k,G as R,k as x,l as o,M as h,m as I,n as O,o as D,p as P,R as T,q as z}from"./three-BAiWYwVC.js";const B="/assets/bg-BdAtMeUW.mp3",U="/assets/foot-Ccyd2idd.wav",F="data:audio/mpeg;base64,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3ZKGWEgNT5RJg0o9Rdcgih/qYpNCJJJG5HI5EuRv5HCiAdFv0obrujnqKi2c6P6MrkmMnrkJugCAJokhCEOHx4dKcOs4WDbU5ZjLSILD1gRmrUn9PT6z5xfQ4n+/sEwFv/01VQqZh3hDNK0WAD8UABzGoUcIDNHh//OERBQJjRV3j+GUARMKKrsfwxABJWR0Jw2ryEaQofQaYTIJDBIGuxlZSzGMZ3+qpZ0v7K6K5DudLt///0XPJfORU3YcLFoZiLDoKu1BmXtzJCAForAH5pcrTQGwhwQyPC4Vb6EJIUDQGY5AQIwoh2MrBRKBjGMZ/qqWMmmjLq5M6X///9D6oSfOQ6NdhhRf0V1jC140FNf8JazMzMxwAD8RxxGRiNgeC4ZKCfvea80eLIeE2XMMe1NeTZeZM+hc//OERCYJUEOVjGsGRRJYhv8Y1gyKFXgNZzusAYYgJQfgJWBuGF4hwSRTIExH//1xqVIFQKwY0DIYl6qqqqUAAuFSWPuFVR3KxkHp885qTB2LR1yoICGDVmpFygxZlHIVWDxnOqDAVaAjC8Aec1AAsQbQkimQJiP///ioFEYCJAYPBVJ5mdy4QjMCFLckqaoJYOmQieAAYoMakZxOmgKAzQuYAhzOFELh23GgY0kCkNZnzWFfJd0TFAxmEgFY2S/g//OERD0JaD9fiWcDUhMIcq8S3rBkr//+7l7W3LDyxUVmQkSaO7uxzEAwhS3JlkoXCjFxQ3ULNeVzAGY5TLPGpzdE02gsCoAEvNYZMTIPDSNzSLJnYb0SdhsHM6m8iQVMhL//zv//3rXRE4wWFmoAtZrG3JbWyICD/3RZV1uA1V9nad0eid2YvP+TV3cQTrhLn9u7/dkkCZhZwkCB7zeaUtrSh0FVAq7U/kv////////9XYgyZMmYsBQrN9ervD/R//OERFAJPLdbLhgmhxLJXsZ+MEcquYCb/vcq6+A1V0kU6l5sAnOccWrWdriF5t2GQOEv+2mn/DJ5YsDuR4UE8DWAqWBV2p+VJf+V/9Tf////+r0GTJkzEhoVFcjl12gEswAQ5OKaUJGRmRzCFeLy+TMpkJifhmuEjTvqspNcwEGRMhr9QNHjodpxKGv//5biJ50S////EsrInSLZUUa9qtIrfkn7+J31RMOTinoJHnzCFWTyZl/9AMY2jfKVioe///OERGYI3KUxLwQjThI55l5eCUc0KqHZysYoiR2N/9Q6crevR/aqAif/gs/9R5//+r/+s6y0SqeIkhIVw7iVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//OEZFQAAAGkAAAAAAAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",q="/assets/btn-Pd9-UUws.mp3";class J{constructor(t){this.playStatus=!1,this.status=t,this.footInstance=null,this.sounds={bgm:new r.Howl({src:[B],loop:!0,volume:.1,preload:!0}),foot:new r.Howl({src:[U],volume:.2}),click:new r.Howl({src:[F],volume:.5}),btn:new r.Howl({src:[q],volume:.5})}}play(t){this.sounds[t].playing()||this.sounds[t].play()}playFoot(){this.sounds.foot.playing()||(this.footInstance=this.sounds.foot.play())}ss;stop(t){if(t){this.sounds[t].stop();return}for(let e in this.sounds)this.sounds[e].stop();this.playStatus=!1}}class Z{constructor(t,e,i,a,n){this.isCamera=!0,this.model=t.instance,this.mixer=t.mixer,this.spawnPosition=t.spawnPosition,this.spawnCapsule=a.spawnCapsule,this.animations=e,this.currentAction={instance:null,name:null},this.sound=i,this.octree=a.octree,this.capsule=a.characterCapsule,this.camera=n.camera,this.cameraOffset=n.cameraOffset,this.orbControl=n.orbControl,this.clock=new d,this.GRAVITY=30,this.angle=0,this.playerVelocity=new s,this.playerOnFloor=!1,this.playerDirection=new s,this.moveState={},this.moveSpeed=3,this.mobileControlsDom={forward:document.querySelector(".up-arrow"),backward:document.querySelector(".down-arrow"),left:document.querySelector(".left-arrow"),right:document.querySelector(".right-arrow")},this.cameraFollowSpeed=.05,this.lookAtFollowSpeed=.08,this.currentCameraOffset=new s().copy(this.cameraOffset),this.initMobileControls(),this.initAnimation(),this.init(),this.animate()}initMobileControls(){this.mobileControlsDom.forward.addEventListener("touchstart",()=>{this.moveState.forward=!0,this.sound.playFoot("foot")}),this.mobileControlsDom.backward.addEventListener("touchstart",()=>{this.moveState.backward=!0,this.sound.playFoot("foot")}),this.mobileControlsDom.left.addEventListener("touchstart",()=>{this.moveState.left=!0,this.sound.playFoot("foot")}),this.mobileControlsDom.right.addEventListener("touchstart",()=>{this.moveState.right=!0,this.sound.playFoot("foot")}),this.mobileControlsDom.forward.addEventListener("touchend",()=>{this.moveState.forward=!1,this.isMoving()||this.sound.stop("foot")}),this.mobileControlsDom.backward.addEventListener("touchend",()=>{this.moveState.backward=!1,this.isMoving()||this.sound.stop("foot")}),this.mobileControlsDom.left.addEventListener("touchend",()=>{this.moveState.left=!1,this.isMoving()||this.sound.stop("foot")}),this.mobileControlsDom.right.addEventListener("touchend",()=>{this.moveState.right=!1,this.isMoving()||this.sound.stop("foot")})}initAnimation(){this.actions={Idle:this.mixer.clipAction(this.animations[1]),Walk:this.mixer.clipAction(this.animations[5]),Run:this.mixer.clipAction(this.animations[3]),Jump:this.mixer.clipAction(this.animations[2])};for(const t in this.actions)this.actions[t].enabled=!0,this.actions[t].setEffectiveTimeScale(1),this.actions[t].setLoop(V),t!=="Idle"?this.actions[t].setEffectiveWeight(0):this.actions[t].setEffectiveWeight(1);this.actions.Jump.setLoop(u),this.actions.Jump.clampWhenFinished=!0,this.currentAction.instance=this.actions.Idle,this.currentAction.instance.play(),this.currentAction.name="Idle"}init(){window.addEventListener("keydown",t=>{switch(event.key.toLowerCase()){case"w":this.moveState.forward=!0,this.sound.playFoot("foot");break;case"s":this.moveState.backward=!0,this.sound.playFoot("foot");break;case"a":this.moveState.left=!0,this.sound.playFoot("foot");break;case"d":this.moveState.right=!0,this.sound.playFoot("foot");break}}),window.addEventListener("keyup",t=>{switch(event.key.toLowerCase()){case"w":this.moveState.forward=!1,this.isMoving()||this.sound.stop("foot");break;case"s":this.moveState.backward=!1,this.isMoving()||this.sound.stop("foot");break;case"a":this.moveState.left=!1,this.isMoving()||this.sound.stop("foot");break;case"d":this.moveState.right=!1,this.isMoving()||this.sound.stop("foot");break}})}isMoving(){return this.moveState.forward||this.moveState.backward||this.moveState.left||this.moveState.right}handleContinuousMovement(t){if(!this.model)return;const e=this.playerVelocity.y;this.playerVelocity.x=0,this.playerVelocity.z=0,this.moveState.forward&&(this.playerVelocity.z+=this.moveSpeed),this.moveState.backward&&(this.playerVelocity.z-=this.moveSpeed),this.moveState.left&&(this.playerVelocity.x-=this.moveSpeed),this.moveState.right&&(this.playerVelocity.x+=this.moveSpeed),this.playerVelocity.y=e}updatePlayer(t){if(!this.model)return;if(this.model.position.y<-20){this.respawnCharacter();return}this.playerOnFloor||(this.playerVelocity.y-=this.GRAVITY*t);const e=this.playerVelocity.clone().multiplyScalar(.025);if(this.capsule.translate(e),this.playerCollisions(),this.model.position.copy(this.capsule.start),this.model.position.y-=2.2,this.playerVelocity.length()>0){const i=Math.atan2(-this.playerVelocity.x,-this.playerVelocity.z);this.model.rotation.y=i}this.isCamera&&this.updateCamera()}playerCollisions(){const t=this.octree.capsuleIntersect(this.capsule);if(this.playerOnFloor=!1,t)if(this.playerOnFloor=t.normal.y>0,t.depth>=1e-10&&this.capsule.translate(t.normal.multiplyScalar(t.depth)),this.playerOnFloor){this.playerVelocity.y=Math.max(this.playerVelocity.y,0);const e=Math.max(.5,t.normal.y);this.playerVelocity.x*=e,this.playerVelocity.z*=e}else{const e=this.playerVelocity.dot(t.normal);e<0&&this.playerVelocity.addScaledVector(t.normal,-e)}}respawnCharacter(){this.model.position.copy(this.spawnPosition),this.capsule.start=this.spawnCapsule.start.clone(),this.capsule.end=this.spawnCapsule.end.clone(),this.playerVelocity.set(0,0,0)}updateAnimation(){let e=this.isMoving()?"Walk":"Idle";this.currentAction.name!==e&&this.switchToAction(e)}switchToAction(t){const e=this.actions[t],i=this.currentAction.instance,a=.3;i.fadeOut(a),e.reset(),e.setEffectiveWeight(1),e.fadeIn(a),e.play(),this.currentAction.instance=e,this.currentAction.name=t}updateCamera(){if(!this.model)return;const t=new s(this.model.position.x+this.cameraOffset.x,this.model.position.y+this.cameraOffset.y,this.model.position.z+this.cameraOffset.z),e=new s(this.model.position.x,this.model.position.y+1.5,this.model.position.z);this.camera.position.lerp(t,this.cameraFollowSpeed);const i=new s;this.camera.getWorldDirection(i);const a=new s().subVectors(e,this.camera.position).normalize(),n=new s;n.lerpVectors(i,a,this.lookAtFollowSpeed);const m=new s().copy(this.camera.position).add(n);this.camera.lookAt(m),this.orbControl&&(this.orbControl.target.lerp(e,this.lookAtFollowSpeed),this.orbControl.update())}animate(){const t=this.clock.getDelta();this.mixer&&this.mixer.update(t),this.handleContinuousMovement(t),this.updatePlayer(t),this.updateAnimation(),requestAnimationFrame(()=>this.animate())}}const H={about:{title:"关于我 (Seven_Sun) 💕💕💕 ",content:`
            <p>我是一名前端开发工程师，对前端技术充满热情，热衷于探索和尝试新技术。</p>
            <p>我熟练使用HTML、CSS、JavaScript等前端技术，熟练Vue等主流前端框架。</p>
            <p>熟悉THREE.js、WebGL等图形学技术。</p>
            <div>HTML CSS JavaScript </div>
            <progress value="98" max="100"></progress>
            <div>Vue</div> 
            <progress value="98" max="100"></progress>
            <div>ThreeJS</div> 
            <progress value="50" max="100"></progress>
            <div>Blender</div> 
            <progress value="20" max="100"></progress>
            <div>Ctrl C&V😁</div> 
            <progress value="100" max="100"></progress>
            <div>Author Email: <em>1274562341@qq.com</em></div>
        `},item:{title:"项目介绍 ❤️❤️❤️",content:`
            <p>框架: Vite + ThreeJs</p>
            <p>动画: Gsap</p>
            <p>模型: Blender</p>
            <p>相关链接:</p>
            <p>BGM : 洛克王国BGM remix <a href="https://music.163.com/#/song?id=1467183188" target="_black">🔗</a><p>
            <p>ThreeJS : <a href="https://threejs.org/manual/#en/installation" target="_black">🔗</a><p>
            <p>Blender : <a href="https://www.blender.org/" target="_black">🔗</a><p>
            <p>Gsap : <a href="https://greensock.com/gsap/" target="_black">🔗</a><p>
            <p>人物模型 : <a href="https://www.mixamo.com/" target="_black">🔗</a><p>
        `},other1:{title:"其他 🤔🤔🤔",content:`
            <h3>永远相信，美好的事情即将发生。</h3>
        `},other2:{title:"其他 🤔🤔🤔",content:`
            <h3>不见得每天都是好日子，但是每天总会有些好事是要发生的。</h3>
        `},other3:{title:"其他 🤔🤔🤔",content:`
            <h3>愿你心存美好，永远相信美好的事情即将发生。</h3>
        `}};class Q{constructor(t){this.sound=t,this.closeModalButton=document.getElementById("closeModal"),this.modalOverlay=document.getElementById("modalOverlay"),this.confirmButton=document.getElementById("confirmButton"),this.modalTitle=document.querySelector(".modal-title"),this.modalContent=document.querySelector(".modal-content"),this.closeModalButton.addEventListener("click",this.closeModal.bind(this),!1),this.confirmButton.addEventListener("click",this.closeModal.bind(this),!1),this.modalOverlay.addEventListener("click",e=>{e.target===modalOverlay&&this.closeModal()})}openModal(t){const e=H[t];this.sound.play("btn"),this.modalOverlay.classList.add("active"),this.modalTitle.textContent=e.title,this.modalContent.innerHTML=e.content}closeModal(){this.sound.play("btn"),this.modalOverlay.classList.remove("active")}}class G{constructor(){this.BASE_PATH="",this.sound=new J,this.modal=new Q(this.sound),this.octree=new p,this.CAPSULE_RADIUS=1,this.CAPSULE_HEIGHT=4,this.characterCapsule=new A(new s(0,this.CAPSULE_RADIUS,0),new s(0,this.CAPSULE_HEIGHT,0),this.CAPSULE_RADIUS),this.doms={canvas:document.getElementById("canvas"),parent:document.querySelector(".loading"),loadingValue:document.querySelector(".loading-value"),startGame:document.querySelector(".loaded"),musicDom:document.querySelector(".right-music"),photoDom:document.querySelector(".right-camera"),lightDom:document.querySelector(".light-box"),messageDom:document.querySelector(".message-box")},this.sizes={width:window.innerWidth,height:window.innerHeight},this.cameraAniimations={default:{pos:new s(1.18,79.06,7e-5),zom:.06},center:{pos:new s(1.18,79.06,7e-5),zom:.36},laset:{pos:new s(56.74,33.35,56.9),zom:1.56}},this.musicStatus=!0,this.lightStatus=!0,this.currentActionShowMore={object:null,name:null},this.currentAnimal={object:null,name:null},this.clock=new d,this.videoDom=[],this.initScene(),this.initCamera(),this.initRender(),this.initControl(),this.initLight(),this.initLoader(),this.initMaterial(),this.initModel(),this.initRaycaster(),this.initEvent(),this.animate()}initStats(){this.stats=new g,this.stats.showPanel(0),document.body.appendChild(this.stats.dom)}initScene(){this.scene=new w,this.scene.background=new f(11454834)}initCamera(){this._a=50;const t=this.sizes.width/this.sizes.height;this.camera=new y(-t*50,t*50,50,-50,1,1e3),this.camera.position.copy(this.cameraAniimations.default.pos),this.camera.zoom=this.cameraAniimations.default.zom,this.cameraOffset=this.cameraAniimations.laset.pos.clone()}initRender(){this.renderer=new M({canvas:this.doms.canvas,antialias:!0}),this.renderer.setSize(this.sizes.width,this.sizes.height),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=v,this.renderer.toneMapping=b,this.renderer.toneMappingExposure=1.7,this.renderer.outputColorSpace=l}initControl(){this.orbControl=new C(this.camera,this.renderer.domElement),this.orbControl.enableDamping=!0,this.orbControl.target.set(0,10,0),this.orbControl.enablePan=!1,this.orbControl.maxPolarAngle=Math.PI/2-.3}initLight(){this.lightColor=16777215,this.ambientLight=new S(this.lightColor,2.7),this.directionLight=new L(this.lightColor,1),this.directionLight.position.set(-120,160,50),this.directionLight.castShadow=!0,this.directionLight.shadow.mapSize.width=4096,this.directionLight.shadow.mapSize.height=4096;const t=150;this.directionLight.shadow.camera.left=-t,this.directionLight.shadow.camera.right=t,this.directionLight.shadow.camera.top=t,this.directionLight.shadow.camera.bottom=-t,this.directionLight.shadow.normalBias=.2,this.scene.add(this.ambientLight,this.directionLight)}initLoader(){this.loadingManger=new E,this.textureLoader=new k(this.loadingManger),this.gltfLoader=new R(this.loadingManger),this.dracoLoader=new x(this.loadingManger),this.dracoLoader.setDecoderPath(`${this.BASE_PATH}/draco/`),this.dracoLoader.setDecoderConfig({type:"js"}),this.gltfLoader.setDRACOLoader(this.dracoLoader),this.progress={value:0},this.progressTo=o.quickTo(this.progress,"value",{duration:.5,ease:"power1.inOut",onUpdate:()=>{this.doms.loadingValue.innerHTML=Math.round(this.progress.value)}}),this.loadingManger.onProgress=(t,e,i)=>{const a=e/i*100;this.progressTo(a)}}initMaterial(){const t=this.textureLoader.load(`${this.BASE_PATH}/textures/road.png`);t.flipY=!1,t.colorSpace=l,this.roadMaterial=new h({map:t}),this.videoMaterial=new h({map:this.createVideoMaterial(`${this.BASE_PATH}/textures/item.mp4`),transparent:!0,opacity:1}),this.videoMaterial2=new h({map:this.createVideoMaterial(`${this.BASE_PATH}/textures/item2.mp4`),transparent:!0,opacity:.5})}createVideoMaterial(t){const e=document.createElement("video");e.src=t,e.muted=!0,e.loop=!0,this.videoDom.push(e),e.setAttribute("playsinline",""),e.setAttribute("autoPlay",""),e.setAttribute("preload","auto");const i=new I(e);return i.flipY=!1,i.colorSpace=l,i}async initModel(){this.farmModel=await this.gltfLoader.loadAsync(`${this.BASE_PATH}/model/farm.glb`),this.handleFarmModel(),this.farmRoadModel=await this.gltfLoader.loadAsync(`${this.BASE_PATH}/model/road.glb`),this.handleFarmRoadModel(),this.characterModel=await this.gltfLoader.loadAsync(`${this.BASE_PATH}/model/character.glb`),this.handleCharacterModel(),this.startAnimation(),this.collicionModel=await this.gltfLoader.loadAsync(`${this.BASE_PATH}/model/pz.glb`),this.handCollisionModel()}handleFarmModel(){const t=this.farmModel.scene;this.handleNode(t,e=>{e.name==="视频展示"&&(e.material=this.videoMaterial),e.name==="视频展示2"&&(e.material=this.videoMaterial2),e.name==="风车"&&o.to(e.rotation,{x:Math.PI*2,duration:10,repeat:-1,ease:"linear"})}),this.scene.add(t)}handleFarmRoadModel(){const t=this.farmRoadModel.scene;this.handleNode(t,e=>{e.material=this.roadMaterial}),this.scene.add(t)}handleCharacterModel(){const t=this.characterModel.scene;this.characterCapsule.start.copy(new s(0,4.25,0)).add(new s(0,this.CAPSULE_RADIUS,0)),this.characterCapsule.end.copy(new s(0,4.25,0)).add(new s(0,this.CAPSULE_HEIGHT,0)),this.characterMoveInstance=new Z({instance:t,mixer:new O(t),spawnPosition:t.position.clone()},this.characterModel.animations,this.sound,{octree:this.octree,characterCapsule:this.characterCapsule,spawnCapsule:{start:this.characterCapsule.start.clone(),end:this.characterCapsule.end.clone()}},{camera:this.camera,cameraOffset:this.cameraOffset,orbControl:this.orbControl}),this.scene.add(t);const e=new D(this.CAPSULE_RADIUS,this.CAPSULE_HEIGHT,4,8),i=new h({color:16711680,wireframe:!0});new P(e,i).position.set(0,4.25,0)}handleNode(t,e){t.traverse(i=>{i.castShadow=!0,i.receiveShadow=!0,e&&e(i)})}handCollisionModel(){const t=this.collicionModel.scene;this.octree.fromGraphNode(t)}startAnimation(){this.progressTo(100),o.timeline({repeat:-1,yoyo:!0}).to([".loading-bar",".loading-text"],{duration:2,color:"rgba(255, 255, 255, 0.3)",ease:"sine.inOut"},0).to(".loading-value",{duration:2,color:"rgba(255, 255, 255, 0.8)",ease:"sine.inOut"},0).to(".loading",{duration:2,backgroundColor:"rgba(174, 201, 114, 0.95)",ease:"sine.inOut"},0),o.to([this.camera.position,this.camera],{duration:2,x:this.cameraAniimations.center.pos.x,y:this.cameraAniimations.center.pos.y,z:this.cameraAniimations.center.pos.z,zoom:this.cameraAniimations.center.zom,ease:"power2.inOut",onUpdate:()=>{this.camera.updateProjectionMatrix()}},0),o.to([this.camera.position,this.camera],{duration:6,x:this.cameraAniimations.laset.pos.x,y:this.cameraAniimations.laset.pos.y,z:this.cameraAniimations.laset.pos.z,zoom:this.cameraAniimations.laset.zom,ease:"power2.inOut",onUpdate:()=>{this.camera.updateProjectionMatrix()}}),this.doms.startGame.classList.add("active-cursor"),o.to([".loaded",".tip"],{duration:1,opacity:1,ease:"sine.inOut"})}initEvent(){this.doms.startGame.addEventListener("click",this.onStartGame.bind(this),!1),this.doms.musicDom.addEventListener("click",this.onMusic.bind(this),!1),this.doms.lightDom.addEventListener("click",this.onLight.bind(this),!1),this.doms.photoDom.addEventListener("click",this.onPhoto.bind(this),!1),this.doms.canvas.addEventListener("click",this.onCanvas.bind(this),!1),window.addEventListener("mousemove",this.onMouseMove.bind(this),!1),window.addEventListener("resize",this.onResize.bind(this),!1),window.addEventListener("contextmenu",function(t){t.preventDefault()}),window.addEventListener("dblclick",function(t){t.preventDefault()}),window.addEventListener("touchstart",function(t){t.touches.length>1&&t.preventDefault()}),window.addEventListener("gesturestart",function(t){t.preventDefault()}),window.addEventListener("gesturechange",function(t){t.preventDefault()}),window.addEventListener("gestureend",function(t){t.preventDefault()})}onStartGame(){this.sound.play("btn"),o.to(".loading",{duration:2,opacity:0,ease:"sine.inOut",onComplete:()=>{this.doms.parent.remove(),this.sound.play("bgm"),this.videoDom.forEach(e=>{e.play()})}}),o.timeline().to(".controls",{duration:2,opacity:1,ease:"sine.inOut"}).to(".right-music",{rotation:360,duration:10,repeat:-1,ease:"linear"},"<")}onMusic(){this.sound.play("btn");const t=this.doms.musicDom.children[0];switch(this.musicStatus=!this.musicStatus,this.musicStatus){case!0:this.sound.play("bgm"),t.src="/assets/music.png";break;case!1:this.sound.stop("bgm"),t.src="/assets/stop_music.png";break}}onLight(){this.sound.play("btn");const t=this.doms.lightDom.children[0];switch(this.lightStatus=!this.lightStatus,this.lightStatus){case!0:this.changeLight(!0),t.src="/assets/light.png";break;case!1:this.changeLight(!1),t.src="/assets/night.png";break}}changeLight(t){o.to(this.ambientLight.color,{r:t?1:.25,g:t?1:.31,b:t?1:.78,duration:1,ease:"power2.inOut"}),o.to(this.ambientLight,{intensity:t?.8:.9,duration:1,ease:"power2.inOut"}),o.to(this.directionLight,{intensity:t?1:.8,duration:1,ease:"power2.inOut"}),o.to(this.directionLight.color,{r:t?1:.25,g:t?1:.41,b:t?1:.88,duration:1,ease:"power2.inOut"})}onPhoto(){this.characterMoveInstance&&(this.sound.play("btn"),this.characterMoveInstance.isCamera=!this.characterMoveInstance.isCamera,this.doms.messageDom.children[0].innerHTML=this.characterMoveInstance.isCamera?"切换到跟随视角":"切换到上帝视角",o.to(".message-box",{opacity:1,duration:3,ease:"sine.inOut",onComplete:()=>{o.to(".message-box",{opacity:0,duration:1,ease:"sine.inOut"})}}))}onCanvas(){this.currentActionShowMore.object?(this.sound.play("btn"),this.currentActionShowMore.name.includes("关于我")?this.modal.openModal("about"):this.currentActionShowMore.name.includes("关于项目")?this.modal.openModal("item"):this.currentActionShowMore.name==="视频展示"?this.modal.openModal("other1"):this.currentActionShowMore.name==="视频展示2"?this.modal.openModal("other2"):this.currentActionShowMore.name==="视频展示3"&&this.modal.openModal("other3")):this.currentAnimal.object&&(this.sound.play("click"),o.to(this.currentAnimal.object.scale,{x:1.2,y:1.2,z:1.2,duration:.5,yoyo:!0,repeat:1,onComplete:()=>{this.currentAnimal.object=null,this.currentAnimal.name=null}}))}onMouseMove(t){this.mouse.x=t.clientX/window.innerWidth*2-1,this.mouse.y=-(t.clientY/window.innerHeight)*2+1}initRaycaster(){this.raycaster=new T,this.mouse=new z}checkRaycast(){if(!this.farmModel)return;this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.raycaster.intersectObjects(this.farmModel.scene.children,!0);if(t.length>0){const e=t[0];console.log(e.object.name),e.object.parent.name.includes("展示牌")?(this.currentActionShowMore.object=e.object.parent,this.currentActionShowMore.name=e.object.name,document.body.style.cursor="pointer"):e.object.name.includes("animal")?(this.doms.canvas.classList.add("cursor-pointer"),document.body.style.cursor="pointer",this.currentAnimal.object=e.object,this.currentAnimal.name=e.object.name):e.object.name.includes("视频展示")?(this.currentActionShowMore.object=e.object,this.currentActionShowMore.name=e.object.name,document.body.style.cursor="pointer"):(this.currentActionShowMore.object=null,this.currentActionShowMore.name=null,this.currentAnimal.object=null,this.currentAnimal.name=null,document.body.style.cursor="default")}}onResize(){this.sizes.width=window.innerWidth,this.sizes.height=window.innerHeight;const t=this.sizes.width/this.sizes.height;this.camera.left=-t*this._a,this.camera.right=t*this._a,this.camera.top=this._a,this.camera.bottom=-this._a,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.sizes.width,this.sizes.height),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))}animate(){this.clock.getDelta(),this.checkRaycast(),this.orbControl.update(),this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animate.bind(this))}}new G;
